@page
@model RepairCostsModel
@{
    ViewData["Title"] = "Raport kosztów napraw";
}

<h2>Raport kosztów napraw klienta</h2>

<form method="post">
    <div class="form-group">
        <label>Klient</label>
        <select asp-for="SelectedCustomerId" asp-items="@(new SelectList(Model.Customers, "Id", "FullName"))" class="form-control"></select>
    </div>

    <div class="form-group">
        <label>Pojazd (opcjonalnie)</label>
        <select asp-for="SelectedVehicleId" asp-items="@(new SelectList(Model.Vehicles, "Id", "RegistrationNumber"))" class="form-control">
            <option value="">-- Wszystkie --</option>
        </select>
    </div>

    <div class="form-group">
        <label>Miesiąc</label>
        <input type="number" asp-for="SelectedMonth" min="1" max="12" class="form-control" />
    </div>

    <div class="form-group">
        <label>Rok</label>
        <input type="number" asp-for="SelectedYear" min="2000" max="2100" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary mt-2">Filtruj</button>
</form>

@if (Model.ReportItems.Any())
{
    <hr />
    <h3>Wyniki</h3>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Data</th>
            <th>Pojazd</th>
            <th>Opis</th>
            <th>Robocizna (zł)</th>
            <th>Części (zł)</th>
            <th>Razem (zł)</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var item in Model.ReportItems)
        {
            <tr>
                <td>@item.OrderDate.ToShortDateString()</td>
                <td>@item.VehicleInfo</td>
                <td>@item.Description</td>
                <td>@item.LaborCost.ToString("F2")</td>
                <td>@item.PartsCost.ToString("F2")</td>
                <td>@(item.LaborCost + item.PartsCost)</td>
            </tr>
        }
        </tbody>
        <tfoot>
        <tr>
            <th colspan="3">Suma</th>
            <th>@Model.TotalLaborCost.ToString("F2")</th>
            <th>@Model.TotalPartsCost.ToString("F2")</th>
            <th>@Model.TotalCost.ToString("F2")</th>
        </tr>
        </tfoot>
    </table>
    
    <form method="post" asp-page-handler="GeneratePdf">
        <input type="hidden" name="CustomerId" value="@Model.SelectedCustomerId" />
        <input type="hidden" name="SelectedVehicleId" value="@Model.SelectedVehicleId" />
        <input type="hidden" name="SelectedMonth" value="@Model.SelectedMonth" />
        <button type="submit" class="btn btn-outline-danger">Generuj PDF</button>
    </form>

}
